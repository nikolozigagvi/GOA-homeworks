<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Niklik ‚Äî Search, Play & Explore</title>
  <meta name="description" content="Niklik: playful search homepage with built-in mini-games, leaderboards, themes, profiles, and micro-tools." />
  <meta name="theme-color" content="#4285F4">
  <style>
    :root{--bg:#f6f7f8;--card:#fff;--muted:#5f6368;--accent:#ff6b6b;--primary:#4285F4;--glass:rgba(255,255,255,0.7)}
    [data-theme="dark"]{--bg:#0b0f14;--card:#0f1720;--muted:#9aa4b2;--accent:#ff6b6b;--primary:#4ea3ff;--glass:rgba(255,255,255,0.03);color:#e6eef8}

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;color:#202124;background:linear-gradient(180deg,var(--bg),#ffffff)}
    [data-theme="dark"] body{background:linear-gradient(180deg,var(--bg),#020406)}
    .page{min-height:100vh;display:flex;flex-direction:column}
    .topbar{padding:12px 20px;display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;gap:12px;align-items:center}
    .brand .logo{font-weight:800;color:var(--primary);font-size:20px;letter-spacing:0.6px}
    .nav-right{display:flex;gap:10px;align-items:center}
    .btn{background:var(--primary);color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .ghost{background:transparent;color:var(--muted);border:1px solid rgba(0,0,0,0.06)}
    .hero{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px}
    .searchbox{width:100%;max-width:900px;display:flex;flex-direction:column;gap:12px;align-items:center}
    .input-wrap{width:100%;display:flex;align-items:center;background:var(--card);border-radius:44px;padding:12px 14px;box-shadow:0 2px 6px rgba(16,24,40,0.06)}
    input[type=search]{flex:1;border:0;outline:0;font-size:18px;background:transparent;color:inherit}
    .controls{display:flex;gap:12px}
    .hint{color:var(--muted);font-size:13px}
    footer{padding:12px 20px;color:var(--muted);display:flex;justify-content:space-between;border-top:1px solid rgba(60,64,67,0.04)}

    /* Modal / Apps */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:60}
    .modal{background:var(--card);padding:18px;border-radius:12px;max-width:1100px;width:calc(100% - 40px);max-height:90vh;overflow:auto}
    .apps-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .app-card{padding:12px;border-radius:8px;border:1px solid rgba(60,64,67,0.06);display:flex;flex-direction:column;gap:8px;background:var(--glass)}
    .app-card h3{margin:0;font-size:16px}
    .game-area{min-height:240px;display:flex;align-items:center;justify-content:center}
    .snake-canvas{background:#0b1220;border-radius:8px}
    .clicker-button{padding:18px 28px;font-size:18px;border-radius:12px;border:0;cursor:pointer}

    /* Tetris */
    .tetris-canvas{background:#071022;border-radius:8px}

    /* TicTacToe */
    .ttt-grid{display:grid;grid-template-columns:repeat(3,80px);gap:8px}
    .ttt-cell{width:80px;height:80px;background:var(--card);display:flex;align-items:center;justify-content:center;font-size:34px;border-radius:8px;cursor:pointer}

    /* Memory */
    .mem-grid{display:grid;grid-template-columns:repeat(4,80px);gap:8px}
    .mem-card{width:80px;height:80px;border-radius:8px;background:var(--card);display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer}

    /* Shake animation */
    @keyframes shakeIt{0%{transform:translateX(0)}20%{transform:translateX(-12px)}40%{transform:translateX(10px)}60%{transform:translateX(-6px)}80%{transform:translateX(4px)}100%{transform:translateX(0)}}
    .shaking{animation:shakeIt 650ms ease-in-out}

    /* settings */
    .settings{display:flex;gap:12px;align-items:center}
    .row{display:flex;gap:10px}
    .close-btn{background:transparent;border:0;font-size:18px;cursor:pointer}
    .muted{color:var(--muted)}
    .flex-between{display:flex;justify-content:space-between;align-items:center}

    /* leaderboard */
    .leaderboard{max-height:200px;overflow:auto;padding:8px;background:linear-gradient(180deg,var(--glass),transparent);border-radius:8px}

    @media (max-width:520px){.input-wrap{padding:10px}.brand .logo{font-size:18px}.ttt-cell,.mem-card{width:58px;height:58px;font-size:22px}}
  </style>
</head>
<body data-theme="light">
  <main class="page">
    <header class="topbar">
      <div class="brand">
        <div class="logo">Niklik</div>
        <div class="muted">Search ‚Ä¢ Play ‚Ä¢ Explore</div>
      </div>
      <div class="nav-right">
        <div class="settings">
          <button id="themeToggle" class="ghost" title="Toggle theme">üåô</button>
          <button id="profileBtn" class="ghost">Profile</button>
          <button id="appsBtn" class="btn">Apps</button>
        </div>
      </div>
    </header>

    <section class="hero" role="main">
      <div class="logo-svg" aria-hidden="true" style="margin-bottom:8px">
        <svg width="110" height="110" viewBox="0 0 100 100" aria-hidden>
          <rect width="100" height="100" rx="16" fill="#fff" stroke="#eee"></rect>
          <path d="M18 78 L40 22 L60 78 L82 22" stroke="#ff6b6b" stroke-width="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>

      <form id="searchForm" class="searchbox" role="search">
        <div class="input-wrap">
          <input id="q" name="q" type="search" placeholder="Search the web with Niklik or type a URL" autocomplete="off" required />
          <button id="voiceBtn" class="btn" type="button" title="Voice search">üé§</button>
        </div>
        <div class="controls">
          <button id="searchBtn" class="btn" type="submit">Niklik Search</button>
          <button id="luckyBtn" class="ghost" type="button">I'm Feeling Lucky</button>
        </div>
        <p class="hint">Tip: press Enter to search. Use Apps to open games & tools. Your progress is saved locally.</p>
      </form>
    </section>

    <footer>Made with ‚ù§Ô∏è ‚Äî <span class="muted">Niklik ‚Ä¢ 2025</span>
      <div></div>
    </footer>
  </main>

  <!-- Modal / Apps -->
  <div id="modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h2 style="margin:0">Niklik Apps & Games</h2>
        <div><button id="closeModal" class="close-btn">‚úï</button></div>
      </div>

      <div style="display:flex;gap:12px;margin-bottom:12px;align-items:center;justify-content:space-between">
        <div class="row">
          <button id="tabGames" class="btn">Games</button>
          <button id="tabTools" class="ghost">Tools</button>
        </div>
        <div class="row">
          <div class="muted">Player: <span id="playerName">Guest</span></div>
          <div style="width:12px"></div>
          <div class="muted">Theme: <span id="currentTheme">Light</span></div>
        </div>
      </div>

      <div id="contentArea">
        <div id="gamesPane">
          <div class="apps-grid">

            <!-- Snake -->
            <div class="app-card">
              <h3>Snake ‚Äî Classic</h3>
              <div class="muted">Arrow keys to move. Eat food to grow. Don't hit walls or yourself.</div>
              <div class="game-area" id="snakeArea">
                <canvas id="snakeCanvas" class="snake-canvas" width="360" height="240"></canvas>
              </div>
              <div class="row"><button class="btn" id="snakeStart">Start</button><button class="ghost" id="snakePause">Pause</button><button class="ghost" id="snakeReset">Reset</button></div>
              <div class="muted">Score: <span id="snakeScore">0</span></div>
              <div class="muted">Top (local):</div>
              <div id="snakeLeaderboard" class="leaderboard"></div>
            </div>

            <!-- Clicker -->
            <div class="app-card">
              <h3>Clicker ‚Äî Rapid Tap</h3>
              <div class="muted">Click the big button to get points. Buy upgrades (auto-clicker).</div>
              <div class="game-area" id="clickerArea">
                <div style="text-align:center">
                  <div id="clickScore" style="font-size:22px;margin-bottom:8px">Score: 0</div>
                  <button id="clickBtn" class="clicker-button btn">CLICK!</button>
                  <div style="margin-top:8px" class="row">
                    <button id="buyAuto" class="ghost">Buy Auto (10)</button>
                    <div id="autoCount" class="muted">Auto: 0</div>
                  </div>
                </div>
              </div>
              <div class="muted">Top (local):</div>
              <div id="clickerLeaderboard" class="leaderboard"></div>
            </div>

            <!-- Tetris -->
            <div class="app-card">
              <h3>Tetris ‚Äî Mini</h3>
              <div class="muted">Arrows to move. Up rotate. Space drop.</div>
              <div class="game-area">
                <canvas id="tetrisCanvas" class="tetris-canvas" width="240" height="400"></canvas>
              </div>
              <div class="row"><button id="tetrisStart" class="btn">Start</button><button id="tetrisReset" class="ghost">Reset</button></div>
              <div class="muted">Score: <span id="tetrisScore">0</span></div>
              <div class="muted">Top (local):</div>
              <div id="tetrisLeaderboard" class="leaderboard"></div>
            </div>

            <!-- TicTacToe -->
            <div class="app-card">
              <h3>Tic‚ÄëTac‚ÄëToe</h3>
              <div class="muted">Play vs CPU (easy) or against a friend.</div>
              <div class="game-area">
                <div>
                  <div id="tttGrid" class="ttt-grid"></div>
                  <div style="margin-top:8px" class="row"><button id="tttReset" class="ghost">Reset</button><button id="tttAIMode" class="btn">Play vs CPU</button></div>
                </div>
              </div>
            </div>

            <!-- Memory -->
            <div class="app-card">
              <h3>Memory ‚Äî Match pairs</h3>
              <div class="muted">Find matching pairs. Faster = higher score.</div>
              <div class="game-area">
                <div>
                  <div id="memGrid" class="mem-grid"></div>
                  <div style="margin-top:8px" class="row"><button id="memReset" class="ghost">Shuffle</button></div>
                </div>
              </div>
            </div>

            <!-- Shake -->
            <div class="app-card">
              <h3>Shake ‚Äî Give it a shake</h3>
              <div class="muted">Shake the page for prizes and a fun animation.</div>
              <div class="game-area" id="shakeArea">
                <div style="text-align:center">
                  <div id="shakeResult" style="margin-bottom:10px">Shake power: 0</div>
                  <button id="shakeBtn" class="btn">SHAKE</button>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div id="toolsPane" style="display:none">
          <div style="display:flex;gap:12px;flex-direction:column">
            <div class="app-card">
              <h3>Timer</h3>
              <div class="muted">Start a countdown.</div>
              <div class="game-area"><div><input id="timerInput" type="number" min="1" value="10" style="width:80px;padding:6px"/> seconds <div style="margin-top:8px" class="row"><button id="timerStart" class="btn">Start</button><button id="timerStop" class="ghost">Stop</button></div><div id="timerDisplay" class="muted" style="margin-top:8px">Idle</div></div></div>
            </div>

            <div class="app-card">
              <h3>Random Joke</h3>
              <div class="muted">Light offline jokes.</div>
              <div class="game-area"><div><button id="jokeBtn" class="btn">Tell me a joke</button><div id="jokeOut" class="muted" style="margin-top:8px">No joke yet.</div></div></div>
            </div>

            <div class="app-card">
              <h3>Color Picker</h3>
              <div class="muted">Pick a color to style Niklik's accent.</div>
              <div class="game-area"><input id="colorPick" type="color" value="#4285F4" style="width:56px;height:56px;border-radius:8px"/><div id="colorNote" class="muted" style="margin-top:8px">Accent: #4285F4</div></div>
            </div>

            <div class="app-card">
              <h3>Leaderboards (all local)</h3>
              <div class="muted">Your top scores for each game are stored locally in your browser.</div>
              <div class="game-area">
                <div style="width:100%">
                  <div class="muted">Snake:</div><div id="lbSnake" class="leaderboard"></div>
                  <div class="muted">Clicker:</div><div id="lbClicker" class="leaderboard"></div>
                  <div class="muted">Tetris:</div><div id="lbTetris" class="leaderboard"></div>
                </div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profileModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h2 style="margin:0">Profile</h2>
        <div><button id="closeProfile" class="close-btn">‚úï</button></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:10px">
        <label>Player name: <input id="nameInput" placeholder="Your name" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/></label>
        <div class="row"><button id="saveName" class="btn">Save</button><button id="clearData" class="ghost">Clear Data</button></div>
        <div class="muted">Your name is saved locally and used in leaderboards.</div>
      </div>
    </div>
  </div>

  <script>
    /*********************** Utilities & Persistence ***************************/
    const STORAGE_KEY = 'niklik_v1';
    const state = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function getPlayerName(){ return state.playerName || 'Guest'; }
    function setPlayerName(n){ state.playerName = n; saveState(); document.getElementById('playerName').textContent = getPlayerName(); }

    // Leaderboard helpers store top N per game
    function addScore(game, score){ state.leaderboards = state.leaderboards || {}; state.leaderboards[game] = state.leaderboards[game] || []; state.leaderboards[game].push({name:getPlayerName(),score: Math.round(score), t:Date.now()}); state.leaderboards[game].sort((a,b)=>b.score-a.score); state.leaderboards[game]=state.leaderboards[game].slice(0,10); saveState(); }
    function getLeaderboard(game){ return (state.leaderboards && state.leaderboards[game])? state.leaderboards[game]: []; }

    // initialize UI values
    document.getElementById('playerName').textContent = getPlayerName();

    /*********************** Search & Voice ***************************/
    (function(){
      const form = document.getElementById('searchForm');
      const qInput = document.getElementById('q');
      const luckyBtn = document.getElementById('luckyBtn');
      function openGoogleSearch(query, options = {lucky:false}){
        if(!query) return window.open('https://www.google.com','_blank');
        const encoded = encodeURIComponent(query.trim());
        if(options.lucky){ window.open('https://www.google.com/search?q='+encoded+'&btnI=1','_blank'); }
        else { window.open('https://www.google.com/search?q='+encoded,'_blank'); }
      }
      form.addEventListener('submit', (e)=>{ e.preventDefault(); openGoogleSearch(qInput.value, {lucky:false}); });
      luckyBtn.addEventListener('click', ()=>{ openGoogleSearch(qInput.value, {lucky:true}); });

      const voiceBtn = document.getElementById('voiceBtn');
      function hasSpeechAPI(){ return !!(window.SpeechRecognition || window.webkitSpeechRecognition); }
      if(hasSpeechAPI()){
        voiceBtn.addEventListener('click', ()=>{
          const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
          const recog = new SpeechRec(); recog.lang = navigator.language || 'en-US'; recog.interimResults=false; recog.maxAlternatives=1;
          voiceBtn.disabled=true; voiceBtn.textContent='üéôÔ∏è';
          recog.start();
          recog.onresult = (ev)=>{ const t = ev.results[0][0].transcript; qInput.value=t; openGoogleSearch(t); };
          recog.onend = ()=>{ voiceBtn.disabled=false; voiceBtn.textContent='üé§'; };
          recog.onerror = ()=>{ voiceBtn.disabled=false; voiceBtn.textContent='üé§'; alert('Voice search failed'); };
        });
      } else { voiceBtn.style.opacity=0.5; voiceBtn.title='Voice not supported'; }

      window.addEventListener('load', ()=> qInput.focus());
    })();

    /*********************** UI: Modal, Tabs, Theme, Profile *******************/
    (function(){
      const appsBtn = document.getElementById('appsBtn');
      const modal = document.getElementById('modal');
      const closeModal = document.getElementById('closeModal');
      const tabGames = document.getElementById('tabGames');
      const tabTools = document.getElementById('tabTools');
      const gamesPane = document.getElementById('gamesPane');
      const toolsPane = document.getElementById('toolsPane');

      appsBtn.addEventListener('click', ()=> { modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); refreshLeaderboardsUI(); });
      closeModal.addEventListener('click', ()=>{ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); });
      modal.addEventListener('click', (e)=>{ if(e.target===modal){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); } });

      tabGames.addEventListener('click', ()=>{ gamesPane.style.display='block'; toolsPane.style.display='none'; });
      tabTools.addEventListener('click', ()=>{ gamesPane.style.display='none'; toolsPane.style.display='block'; });

      // Theme
      const themeToggle = document.getElementById('themeToggle');
      const currentThemeLabel = document.getElementById('currentTheme');
      function setTheme(t){ document.body.setAttribute('data-theme', t); currentThemeLabel.textContent = t[0].toUpperCase()+t.slice(1); state.theme = t; saveState(); document.getElementById('themeToggle').textContent = t==='dark' ? '‚òÄÔ∏è' : 'üåô'; }
      setTheme(state.theme || 'light');
      themeToggle.addEventListener('click', ()=>{ setTheme(document.body.getAttribute('data-theme')==='light'? 'dark':'light'); });

      // Profile modal
      const profileBtn = document.getElementById('profileBtn');
      const profileModal = document.getElementById('profileModal');
      const closeProfile = document.getElementById('closeProfile');
      const nameInput = document.getElementById('nameInput');
      const saveName = document.getElementById('saveName');
      const clearData = document.getElementById('clearData');
      profileBtn.addEventListener('click', ()=>{ profileModal.style.display='flex'; profileModal.setAttribute('aria-hidden','false'); nameInput.value = state.playerName || ''; });
      closeProfile.addEventListener('click', ()=>{ profileModal.style.display='none'; profileModal.setAttribute('aria-hidden','true'); });
      saveName.addEventListener('click', ()=>{ setPlayerName(nameInput.value || 'Guest'); profileModal.style.display='none'; });
      clearData.addEventListener('click', ()=>{ if(confirm('Clear all Niklik saved data (leaderboards, name, settings)?')){ localStorage.removeItem(STORAGE_KEY); location.reload(); } });
    })();

    /*********************** Sound helper ***************************/
    const audioCtx = (window.AudioContext||window.webkitAudioContext) ? new (window.AudioContext||window.webkitAudioContext)() : null;
    function beep(freq=440,duration=0.08, vol=0.02){ if(!audioCtx) return; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+duration); }

    /*********************** Snake Game ***************************/
    (function(){
      const canvas = document.getElementById('snakeCanvas');
      const ctx = canvas.getContext('2d');
      const startBtn = document.getElementById('snakeStart');
      const pauseBtn = document.getElementById('snakePause');
      const resetBtn = document.getElementById('snakeReset');
      const scoreEl = document.getElementById('snakeScore');
      const lbEl = document.getElementById('snakeLeaderboard');
      const scale = 20; const cols = Math.floor(canvas.width/scale); const rows = Math.floor(canvas.height/scale);
      let snake = [], food = {}, dir = {x:1,y:0}, loopId=null, speed=120, paused=false;

      function init(){ snake = [{x:Math.floor(cols/2), y:Math.floor(rows/2)}]; dir={x:1,y:0}; placeFood(); scoreEl.textContent = '0'; paused=false; draw(); }
      function placeFood(){ food = {x:Math.floor(Math.random()*cols), y:Math.floor(Math.random()*rows)}; if(snake.some(s=>s.x===food.x && s.y===food.y)) placeFood(); }
      function draw(){ ctx.fillStyle = document.body.getAttribute('data-theme')==='dark' ? '#061019':'#0b1220'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle = '#ffcc00'; ctx.fillRect(food.x*scale+2, food.y*scale+2, scale-4, scale-4); ctx.fillStyle = '#34e89e'; snake.forEach(s=> ctx.fillRect(s.x*scale+1, s.y*scale+1, scale-2, scale-2)); }
      function step(){ if(paused) return; const head = {x:snake[0].x+dir.x, y:snake[0].y+dir.y}; if(head.x<0||head.x>=cols||head.y<0||head.y>=rows || snake.some(s=>s.x===head.x && s.y===head.y)){ clearInterval(loopId); loopId=null; const score = snake.length-1; addScore('snake', score); refreshLeaderboardsUI(); alert('Game over! Score: '+score); beep(220,0.12,0.04); return; } snake.unshift(head); if(head.x===food.x && head.y===food.y){ placeFood(); beep(880,0.06,0.02); } else snake.pop(); scoreEl.textContent = snake.length-1; draw(); }
      document.addEventListener('keydown', (e)=>{ const k=e.key; if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(k)) e.preventDefault(); if(k==='ArrowUp' && dir.y!==1) dir={x:0,y:-1}; if(k==='ArrowDown' && dir.y!==-1) dir={x:0,y:1}; if(k==='ArrowLeft' && dir.x!==1) dir={x:-1,y:0}; if(k==='ArrowRight' && dir.x!==-1) dir={x:1,y:0}; if(k===' '){ if(loopId) { clearInterval(loopId); loopId=null; paused=true; } else { if(!loopId) loopId=setInterval(step,speed); paused=false; } } });
      startBtn.addEventListener('click', ()=>{ if(loopId) return; init(); loopId = setInterval(step,speed); });
      pauseBtn.addEventListener('click', ()=>{ paused=!paused; pauseBtn.textContent = paused ? 'Resume' : 'Pause'; });
      resetBtn.addEventListener('click', ()=>{ clearInterval(loopId); loopId=null; init(); });
      init();
    })();

    /*********************** Clicker ***************************/
    (function(){
      const clickBtn = document.getElementById('clickBtn');
      const scoreEl = document.getElementById('clickScore');
      const buyAuto = document.getElementById('buyAuto');
      const autoCountEl = document.getElementById('autoCount');
      const lbEl = document.getElementById('clickerLeaderboard');
      state.clicker = state.clicker || {score:0,auto:0,cost:10};
      function render(){ scoreEl.textContent = 'Score: '+Math.floor(state.clicker.score); autoCountEl.textContent = 'Auto: '+state.clicker.auto; buyAuto.textContent = 'Buy Auto ('+state.clicker.cost+')'; }
      clickBtn.addEventListener('click', ()=>{ state.clicker.score += 1; render(); beep(440,0.04,0.02); saveState(); });
      buyAuto.addEventListener('click', ()=>{ if(state.clicker.score>=state.clicker.cost){ state.clicker.score -= state.clicker.cost; state.clicker.auto +=1; state.clicker.cost = Math.ceil(state.clicker.cost*1.9); render(); saveState(); } else alert('Not enough score'); });
      setInterval(()=>{ if(state.clicker.auto>0){ state.clicker.score += state.clicker.auto*0.2; render(); saveState(); } },1000);
      // long-press to submit score to leaderboard
      document.getElementById('clickerArea').addEventListener('dblclick', ()=>{ addScore('clicker', state.clicker.score); refreshLeaderboardsUI(); alert('Submitted clicker score: '+Math.round(state.clicker.score)); });
      render();
    })();

    /*********************** Tetris (simplified) ***************************/
    (function(){
      const canvas = document.getElementById('tetrisCanvas');
      const ctx = canvas.getContext('2d');
      const cols = 10, rows = 20; const block = 20; canvas.width = cols*block; canvas.height = rows*block;
      const tStart = document.getElementById('tetrisStart');
      const tReset = document.getElementById('tetrisReset');
      const scoreEl = document.getElementById('tetrisScore');
      let grid = createGrid(); let current=null; let loop=null; let speed=700; let score=0;

      const pieces = [
        [[1,1,1,1]], // I
        [[1,1],[1,1]], // O
        [[0,1,0],[1,1,1]], // T
        [[1,0,0],[1,1,1]], // L
        [[0,0,1],[1,1,1]], // J
        [[1,1,0],[0,1,1]], // S
        [[0,1,1],[1,1,0]]  // Z
      ];

      function createGrid(){ return Array.from({length:rows},()=>Array(cols).fill(0)); }
      function spawn(){ const p = pieces[Math.floor(Math.random()*pieces.length)]; current = {shape:p, x:Math.floor((cols - p[0].length)/2), y:0}; }
      function draw(){ ctx.fillStyle = document.body.getAttribute('data-theme')==='dark' ? '#071022':'#071022'; ctx.fillRect(0,0,canvas.width,canvas.height); for(let r=0;r<rows;r++){ for(let c=0;c<cols;c++){ if(grid[r][c]){ ctx.fillStyle='#8ad6ff'; ctx.fillRect(c*block+1,r*block+1,block-2,block-2); } } } if(current){ for(let r=0;r<current.shape.length;r++) for(let c=0;c<current.shape[r].length;c++) if(current.shape[r][c]) ctx.fillStyle='#ffd86b', ctx.fillRect((current.x+c)*block+1,(current.y+r)*block+1,block-2,block-2); }
      }
      function collide(nx,ny,shape){ for(let r=0;r<shape.length;r++) for(let c=0;c<shape[r].length;c++) if(shape[r][c]){ const x = nx+c, y=ny+r; if(x<0||x>=cols||y>=rows) return true; if(y>=0 && grid[y][x]) return true; } return false; }
      function merge(){ for(let r=0;r<current.shape.length;r++) for(let c=0;c<current.shape[r].length;c++) if(current.shape[r][c]){ if(current.y+r>=0) grid[current.y+r][current.x+c]=1; } }
      function clearLines(){ let cleared=0; for(let r=rows-1;r>=0;r--){ if(grid[r].every(v=>v)){ grid.splice(r,1); grid.unshift(Array(cols).fill(0)); cleared++; r++; } } if(cleared){ score += cleared*100; scoreEl.textContent = score; } }
      function rotate(matrix){ return matrix[0].map((_,i)=>matrix.map(row=>row[i]).reverse()); }
      function step(){ if(!current) spawn(); if(!collide(current.x, current.y+1, current.shape)) current.y++; else { merge(); clearLines(); spawn(); if(collide(current.x,current.y,current.shape)){ clearInterval(loop); loop=null; addScore('tetris', score); refreshLeaderboardsUI(); alert('Game over! Tetris score: '+score); } } draw(); }
      document.addEventListener('keydown', (e)=>{ if(!current) return; if(e.key==='ArrowLeft' && !collide(current.x-1,current.y,current.shape)) current.x--; if(e.key==='ArrowRight' && !collide(current.x+1,current.y,current.shape)) current.x++; if(e.key==='ArrowDown' && !collide(current.x,current.y+1,current.shape)) current.y++; if(e.key==='ArrowUp'){ const r = rotate(current.shape); if(!collide(current.x,current.y,r)) current.shape = r; } if(e.key===' ') { while(!collide(current.x,current.y+1,current.shape)) current.y++; step(); } draw(); });
      tStart.addEventListener('click', ()=>{ if(loop) return; grid=createGrid(); current=null; score=0; scoreEl.textContent = score; loop = setInterval(step, speed); });
      tReset.addEventListener('click', ()=>{ clearInterval(loop); loop=null; grid=createGrid(); current=null; score=0; scoreEl.textContent = score; draw(); });
      draw();
    })();

    /*********************** TicTacToe ***************************/
    (function(){
      const gridEl = document.getElementById('tttGrid'); const resetBtn = document.getElementById('tttReset'); const aiBtn = document.getElementById('tttAIMode');
      let board = Array(9).fill(null); let turn = 'X'; let vsAI = false; function render(){ gridEl.innerHTML=''; for(let i=0;i<9;i++){ const d=document.createElement('div'); d.className='ttt-cell'; d.textContent = board[i]||''; d.addEventListener('click', ()=>{ if(board[i] || (vsAI && turn==='O')) return; board[i]=turn; turn = turn==='X'?'O':'X'; render(); const win = checkWin(board); if(win){ alert(win.winner+' wins!'); addScore('ttt', win.winner==='X'?1:0); } else if(board.every(Boolean)){ alert('Draw'); } if(vsAI && turn==='O') aiMove(); }); gridEl.appendChild(d); } }
      function aiMove(){ // simple AI: random available
        const avail = board.map((v,i)=>v?null:i).filter(n=>n!==null); if(avail.length===0) return; const pick = avail[Math.floor(Math.random()*avail.length)]; board[pick]='O'; turn='X'; render(); const win = checkWin(board); if(win){ alert(win.winner+' wins!'); } }
      function checkWin(b){ const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]; for(const l of lines){ const [a,b1,c]=l; if(b[a] && b[a]===b[b1] && b[a]===b[c]) return {winner:b[a],line:l}; } return null; }
      resetBtn.addEventListener('click', ()=>{ board=Array(9).fill(null); turn='X'; render(); }); aiBtn.addEventListener('click', ()=>{ vsAI=!vsAI; aiBtn.textContent = vsAI? 'Play vs Friend':'Play vs CPU'; }); render();
    })();

    /*********************** Memory Game ***************************/
    (function(){
      const memGrid = document.getElementById('memGrid'); const memReset = document.getElementById('memReset');
      let cards = [];
      function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
      function initMem(){ const values = [];
        for(let i=1;i<=8;i++){ values.push(i); values.push(i); }
        shuffleArray(values); cards = values.map((v,idx)=>({v,flipped:false,matched:false,idx})); renderMem(); }
      function renderMem(){ memGrid.innerHTML=''; cards.forEach(c=>{ const el=document.createElement('div'); el.className='mem-card'; el.textContent = c.flipped||c.matched? c.v : ''; el.addEventListener('click', ()=>{ if(c.flipped||c.matched) return; c.flipped=true; renderMem(); const flipped = cards.filter(x=>x.flipped&&!x.matched); if(flipped.length===2){ if(flipped[0].v===flipped[1].v){ flipped.forEach(x=>x.matched=true); addScore('memory', 10); setTimeout(()=>renderMem(),400); } else { setTimeout(()=>{ flipped.forEach(x=>x.flipped=false); renderMem(); },600); } } }); memGrid.appendChild(el); }); }
      memReset.addEventListener('click', initMem); initMem();
    })();

    /*********************** Shake ***************************/
    (function(){
      const shakeBtn = document.getElementById('shakeBtn'); const shakeResult = document.getElementById('shakeResult');
      shakeBtn.addEventListener('click', ()=>{ const power = Math.floor(Math.random()*100); document.body.classList.add('shaking'); shakeResult.textContent = 'Shake power: '+power; setTimeout(()=>document.body.classList.remove('shaking'),700); if(power>85){ addScore('shake', power); alert('‚ú® Jackpot! You won a golden niK!'); } else if(power>60){ alert('Nice shake! You got 50 points in Clicker.'); state.clicker = state.clicker || {score:0}; state.clicker.score += 50; saveState(); } });
      // also support device shake (devicemotion)
      if(window.DeviceMotionEvent){ let last=0,mv=0; window.addEventListener('devicemotion', (e)=>{ const acc = e.accelerationIncludingGravity; if(!acc) return; const s = Math.abs(acc.x)+Math.abs(acc.y)+Math.abs(acc.z); if(s>30 && Date.now()-last>1000){ last=Date.now(); shakeBtn.click(); } }); }
    })();

    /*********************** Tools: Timer, Joke, Color Picker *******************/
    (function(){
      const timerInput = document.getElementById('timerInput'); const timerStart = document.getElementById('timerStart'); const timerStop = document.getElementById('timerStop'); const timerDisplay = document.getElementById('timerDisplay'); let timerId=null; timerStart.addEventListener('click', ()=>{ const s = parseInt(timerInput.value)||10; let left=s; timerDisplay.textContent = 'Running: '+left+'s'; timerId = setInterval(()=>{ left--; if(left<=0){ clearInterval(timerId); timerId=null; timerDisplay.textContent='Finished'; alert('Timer finished!'); beep(660,0.12,0.04); } else timerDisplay.textContent = 'Running: '+left+'s'; },1000); }); timerStop.addEventListener('click', ()=>{ if(timerId) clearInterval(timerId); timerId=null; timerDisplay.textContent='Stopped'; });

      const jokeBtn = document.getElementById('jokeBtn'); const jokeOut = document.getElementById('jokeOut'); const jokes = ['Why do programmers prefer dark mode? Because light attracts bugs.','There are only 10 kinds of people: those who understand binary and those who don\'t.','I told my computer I needed a break, it said: Error 404: Coffee not found.']; jokeBtn.addEventListener('click', ()=>{ const j = jokes[Math.floor(Math.random()*jokes.length)]; jokeOut.textContent = j; });

      const colorPick = document.getElementById('colorPick'); const colorNote = document.getElementById('colorNote'); colorPick.addEventListener('input', ()=>{ const v = colorPick.value; document.documentElement.style.setProperty('--primary', v); colorNote.textContent = 'Accent: '+v; state.color = v; saveState(); }); if(state.color) { colorPick.value = state.color; document.documentElement.style.setProperty('--primary', state.color); colorNote.textContent = 'Accent: '+state.color; }
    })();

    /*********************** Leaderboard UI Refresh ***************************/
    function refreshLeaderboardsUI(){ const map = {snake:'snakeLeaderboard', clicker:'clickerLeaderboard', tetris:'tetrisLeaderboard'}; for(const k in map){ const el = document.getElementById(map[k]); el.innerHTML=''; const arr = getLeaderboard(k); if(arr.length===0) el.textContent='‚Äî'; else arr.forEach(row=>{ const d = document.createElement('div'); d.textContent = row.name + ' ‚Äî ' + row.score; el.appendChild(d); }); }
      // global leaderboards pane
      const lbSnake = document.getElementById('lbSnake'); const lbClicker = document.getElementById('lbClicker'); const lbTetris = document.getElementById('lbTetris'); function renderLB(el,game){ el.innerHTML=''; const arr=getLeaderboard(game); if(arr.length===0) el.textContent='‚Äî'; else arr.forEach(r=>{ const d=document.createElement('div'); d.textContent=r.name+' ‚Äî '+r.score; el.appendChild(d); }); }
      renderLB(lbSnake,'snake'); renderLB(lbClicker,'clicker'); renderLB(lbTetris,'tetris');
    }

    /*********************** Initial refresh ***************************/
    refreshLeaderboardsUI();

    /*********************** Expose quick-save on page close ***************************/
    window.addEventListener('beforeunload', ()=>{ saveState(); });

    // Small helpful hints for the user: double-click Clicker area to submit score, etc.

  </script>
</body>
</html>
